<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Application Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        label {
            font-weight: bold;
        }
        input[type="text"], input[type="email"], input[type="number"], input[type="submit"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Ensures padding is included in the width */
        }
        input[type="submit"] {
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        hr {
            border: none;
            border-top: 1px solid #ccc;
            margin: 30px 0;
        }
        #loanDetails {
            display: none;
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        #loanDetails h3 {
            margin-top: 0;
        }
        #loanDetails p {
            margin-bottom: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Loan Application Form</h2>
        
        <form id="loanForm" onsubmit="submitLoanApplication(event)">
            <label for="fullName">Full Name:</label>
            <input type="text" id="fullName" name="fullName" required>

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>

            <label for="phoneNumber">Phone Number:</label>
            <input type="text" id="phoneNumber" name="phoneNumber" required>

            <label for="loanAmount">Loan Amount (INR):</label>
            <input type="number" id="loanAmount" name="loanAmount" required>

            <label for="interestRate">Weekly Interest Rate (%):</label>
            <input type="number" id="interestRate" name="interestRate" step="0.01" required>

            <label for="loanTerm">Loan Term (weeks):</label>
            <input type="number" id="loanTerm" name="loanTerm" required>

            <input type="submit" value="Apply for Loan">
        </form>

        <hr>

        <div id="loanDetails">
            <h3>Loan Application Details</h3>
            <p><strong>Full Name:</strong> <span id="outputFullName"></span></p>
            <p><strong>Email:</strong> <span id="outputEmail"></span></p>
            <p><strong>Phone Number:</strong> <span id="outputPhoneNumber"></span></p>
            <p><strong>Loan Amount:</strong> ₹<span id="outputLoanAmount"></span></p>
            <p><strong>Weekly Interest Rate:</strong> <span id="outputInterestRate"></span>%</p>
            <p><strong>Loan Term (weeks):</strong> <span id="outputLoanTerm"></span></p>
            <p><strong>Total Repayment Amount:</strong> ₹<span id="outputTotalRepayment"></span></p>
            <p><strong>Generated Time:</strong> <span id="generatedTime"></span></p>
            <p><strong>End Time:</strong> <span id="endTime"></span></p>
            <button onclick="downloadLoanDetails('png')">Download as PNG Image</button>
            <button onclick="downloadLoanDetails('pdf')">Download as PDF</button>
        </div>
    </div>

    <script>
        function submitLoanApplication(event) {
            event.preventDefault();

            // Get input values
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const loanAmount = parseFloat(document.getElementById('loanAmount').value);
            const weeklyInterestRate = parseFloat(document.getElementById('interestRate').value);
            const loanTermWeeks = parseInt(document.getElementById('loanTerm').value);

            // Calculate total repayment amount
            const totalRepayment = loanAmount * (1 + (weeklyInterestRate / 100) * loanTermWeeks);

            // Display loan application details
            document.getElementById('outputFullName').textContent = fullName;
            document.getElementById('outputEmail').textContent = email;
            document.getElementById('outputPhoneNumber').textContent = phoneNumber;
            document.getElementById('outputLoanAmount').textContent = loanAmount.toFixed(2);
            document.getElementById('outputInterestRate').textContent = weeklyInterestRate.toFixed(2);
            document.getElementById('outputLoanTerm').textContent = loanTermWeeks;
            document.getElementById('outputTotalRepayment').textContent = totalRepayment.toFixed(2);

            // Show loan details section
            document.getElementById('loanDetails').style.display = 'block';

            // Display generated time
            const generatedTime = new Date().toLocaleString();
            document.getElementById('generatedTime').textContent = generatedTime;

            // Calculate end time based on loan term
            const endDate = new Date();
            endDate.setDate(endDate.getDate() + (loanTermWeeks * 7)); // Calculate end date in days
            const endTime = endDate.toLocaleDateString();
            document.getElementById('endTime').textContent = endTime;
        }

        async function downloadLoanDetails(format) {
            const fullName = document.getElementById('outputFullName').textContent;
            const email = document.getElementById('outputEmail').textContent;
            const phoneNumber = document.getElementById('outputPhoneNumber').textContent;
            const loanAmount = document.getElementById('outputLoanAmount').textContent;
            const interestRate = document.getElementById('outputInterestRate').textContent;
            const loanTerm = document.getElementById('outputLoanTerm').textContent;
            const totalRepayment = document.getElementById('outputTotalRepayment').textContent;
            const generatedTime = document.getElementById('generatedTime').textContent;
            const endTime = document.getElementById('endTime').textContent;

            const loanDetails = `
                Loan Application Details:
                Full Name: ${fullName}
                Email: ${email}
                Phone Number: ${phoneNumber}
                Loan Amount: ₹${loanAmount}
                Weekly Interest Rate: ${interestRate}%
                Loan Term (weeks): ${loanTerm}
                Total Repayment Amount: ₹${totalRepayment}
                Generated Time: ${generatedTime}
                End Time: ${endTime}
            `;

            if (format === 'pdf') {
                // Generate and download PDF on Android devices
                const { jsPDF } = await import('jspdf');
                const pdf = new jsPDF();
                pdf.text(loanDetails, 10, 10);
                pdf.save('loan_application_details.pdf');
            } else if (format === 'png') {
                // Generate and download PNG image
                const html2canvas = await import('html2canvas');
                const loanDetailsContainer = document.getElementById('loanDetails');
                html2canvas.default(loanDetailsContainer).then(function(canvas) {
                    const image = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.href = image;
                    link.download = 'loan_application_details.png';
                    link.click();
                });
            }
        }
    </script>
</body>
</html>